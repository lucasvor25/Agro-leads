<div class="p-4 fadein animation-duration-500" *ngIf="lead; else loadingTemplate">

  <div class="flex flex-column md:flex-row justify-content-between align-items-start md:align-items-center mb-4 gap-3">
    <div>
      <h1 class="text-3xl font-bold m-0 text-900">Detalhes do Lead</h1>
      <div class="flex align-items-center gap-2 mt-2 cursor-pointer text-600 hover:text-primary transition-colors" (click)="goBack()">
        <i class="pi pi-arrow-left text-sm"></i>
        <span>Voltar para Leads</span>
      </div>
    </div>
  </div>

  <div class="surface-card p-4 border-round-2xl shadow-1">
    
    <div class="flex flex-column md:flex-row justify-content-between mb-5 border-bottom-1 surface-border pb-4 gap-4">
      
      <div class="flex flex-column gap-2">
        <div class="flex align-items-center gap-3">
          <i *ngIf="lead.isPriority" class="pi pi-star-fill text-yellow-500 text-2xl" title="Prioridade"></i>
          <h2 class="text-3xl font-bold text-900 m-0">{{ lead.name }}</h2>
          <p-tag [value]="lead.status" [severity]="getStatusSeverity(lead.status)" [rounded]="true"></p-tag>
        </div>
        
        <div class="flex flex-wrap gap-4 mt-2 text-600">
          <span class="flex align-items-center gap-2">
            <i class="pi pi-map-marker"></i> {{ lead.city }}
          </span>
          <span class="flex align-items-center gap-2">
            <i class="pi pi-phone"></i> {{ lead.phone }}
          </span>
          <span class="flex align-items-center gap-2">
            <i class="pi pi-envelope"></i> {{ lead.email }}
          </span>
        </div>
      </div>

      <div class="flex gap-2">
        <button pButton label="Editar" icon="pi pi-pencil" class="p-button-outlined border-round-xl" (click)="editLead()"></button>
        <button pButton label="Excluir" icon="pi pi-trash" class="p-button-outlined p-button-danger border-round-xl" (click)="deleteLead()"></button>
      </div>
    </div>

    <div class="grid mb-5">
      
      <div class="col-12 md:col-6 lg:col-3">
        <div class="surface-50 p-3 border-round-xl h-full">
          <span class="text-500 text-sm font-medium block mb-2">CPF</span>
          <span class="text-900 text-xl font-bold">{{ lead.cpf }}</span>
        </div>
      </div>

      <div class="col-12 md:col-6 lg:col-3">
        <div class="surface-50 p-3 border-round-xl h-full">
          <span class="text-500 text-sm font-medium block mb-2">Área Total</span>
          <span class="text-900 text-xl font-bold">{{ lead.area }} ha</span>
        </div>
      </div>

      <!-- <div class="col-12 md:col-6 lg:col-3">
        <div class="surface-50 p-3 border-round-xl h-full">
          <span class="text-500 text-sm font-medium block mb-2">Propriedades</span>
          <span class="text-900 text-xl font-bold">{{ lead.properties?.length || 0 }}</span>
        </div>
      </div> -->

      <div class="col-12 md:col-6 lg:col-3">
        <div class="surface-50 p-3 border-round-xl h-full">
          <span class="text-500 text-sm font-medium block mb-2">Último Contato</span>
          <span class="text-900 text-xl font-bold">{{ lead.lastContact | date:'dd/MM/yyyy' }}</span>
          <div class="text-xs text-500 mt-1">
             Criado em: {{ lead.createdAt | date:'dd/MM/yyyy' }}
          </div>
        </div>
      </div>

    </div>

    <div>
      <h3 class="text-lg font-bold text-900 mb-3 flex align-items-center gap-2">
        <i class="pi pi-file-edit text-gray-500"></i> Comentários e Observações
      </h3>
      
      <div class="surface-50 border-round-xl p-4 line-height-3 text-700">
        <span *ngIf="lead.obs; else noObs">{{ lead.obs }}</span>
        <ng-template #noObs>
          <span class="text-gray-500 font-italic">Nenhuma observação registrada para este lead.</span>
        </ng-template>
      </div>
    </div>

  </div>
</div>

<ng-template #loadingTemplate>
  <div class="p-4">
    <p-skeleton width="200px" height="3rem" styleClass="mb-4"></p-skeleton>
    <div class="surface-card p-4 border-round shadow-1">
      <p-skeleton width="100%" height="150px" styleClass="mb-4"></p-skeleton>
      <div class="grid">
         <div class="col-3"><p-skeleton height="80px"></p-skeleton></div>
         <div class="col-3"><p-skeleton height="80px"></p-skeleton></div>
         <div class="col-3"><p-skeleton height="80px"></p-skeleton></div>
         <div class="col-3"><p-skeleton height="80px"></p-skeleton></div>
      </div>
    </div>
  </div>
</ng-template>