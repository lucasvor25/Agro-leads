<p-confirmDialog></p-confirmDialog> 
<p-toast></p-toast>

<div class="p-4 fadein animation-duration-500">
  
  <div class="mb-4">
    <h1 class="text-2xl font-bold m-0 text-900">Propriedades Rurais</h1>
    <span class="text-gray-500">
        {{ filteredProperties.length }} propriedades encontradas
    </span>
  </div>

  <div class="flex flex-column md:flex-row justify-content-between align-items-center mb-4 gap-3">
    <button pButton 
        label="Nova Propriedade" 
        icon="pi pi-plus" 
        class="p-button-success ml-auto"
        (click)="openNewPropertyModal()">
    </button>
  </div>

  <app-property-filter 
      [properties]="properties" 
      (onFilterChange)="handleFilterChange($event)">
  </app-property-filter>

  <div class="grid" *ngIf="viewMode === 'list'">
    
    <div class="col-12 md:col-6 lg:col-4" *ngFor="let prop of filteredProperties">
      
      <div class="surface-card shadow-1 p-3 border-round border-left-3 hover:shadow-3 transition-all cursor-default h-full flex flex-column relative"
           [ngClass]="{
             'border-green-500': prop.culture === 'Soja',
             'border-yellow-500': prop.culture === 'Milho',
             'border-blue-500': prop.culture === 'Algodão'
           }">
        
        <div class="flex justify-content-between align-items-start mb-2">
            
            <div class="flex gap-2 flex-1 pr-2"> 
                
                <span class="font-bold text-lg text-900 cursor-pointer hover:text-green-600 transition-colors underline-hover line-height-2"
                      (click)="openLeadDetails(prop.lead?.id)"
                      pTooltip="Ver detalhes do proprietário" tooltipPosition="top">
                    {{ prop.name }}
                </span>
            </div>

            <div class="flex gap-1 flex-shrink-0"> <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-secondary p-button-sm" 
                        pTooltip="Editar" tooltipPosition="left"
                        (click)="editProperty(prop)">
                </button>
                <button pButton icon="pi pi-trash" 
                        class="p-button-rounded p-button-text p-button-danger p-button-sm" 
                        pTooltip="Excluir" tooltipPosition="left"
                        (click)="deleteProperty($event, prop.id)">
                </button>
            </div>

        </div>
        <div class="text-sm font-bold text-green-800 mb-2 cursor-pointer hover:underline"
             (click)="openLeadDetails(prop.lead?.id)">
             <i class="pi pi-user mr-1"></i> {{ prop.lead?.name || 'Proprietário não informado' }}
        </div>

        <div class="text-sm text-500 mb-3 flex gap-3">
            <span><i class="pi pi-map-marker mr-1"></i> {{ prop.city }}</span>
            <span><i class="pi pi-tag mr-1"></i> {{ prop.area }} ha</span>
        </div>

        <div class="mb-3">
            <p-tag [value]="prop.culture" [severity]="getCultureSeverity(prop.culture)"></p-tag>
        </div>

        <div class="text-sm text-600 mt-auto line-height-3 pt-2" *ngIf="prop.obs">
            <i class="pi pi-comment mr-1 text-gray-400"></i> {{ prop.obs }}
        </div>

      </div>
      
    </div>

    <div class="col-12 text-center p-5" *ngIf="filteredProperties.length === 0">
        <div class="flex flex-column align-items-center">
            <i class="pi pi-search text-5xl text-gray-300 mb-3"></i>
            <span class="text-xl font-medium text-gray-600">Nenhuma propriedade encontrada</span>
            <span class="text-gray-500">Tente ajustar os filtros ou a busca.</span>
        </div>
    </div>
  </div>

</div>

<app-property-create (onSave)="loadProperties()"></app-property-create>